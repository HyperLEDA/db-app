{
  "paths": {
    "/ping": {
      "get": {
        "summary": "Test that service is up and running",
        "tags": [
          "admin"
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/PingResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/source": {
      "post": {
        "summary": "New bibliographic entry",
        "description": "Creates new bibliographic entry in the database.",
        "tags": [
          "admin",
          "source"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateSourceRequestSchema"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Source was successfully created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/CreateSourceResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/source/list": {
      "get": {
        "summary": "Obtain list of sources",
        "description": "Obtains a list of sources that satisfy given filters sorted by modification time.",
        "tags": [
          "source"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "title",
            "description": "Filter for the title",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "page_size",
            "description": "Number of entries in the page",
            "schema": {
              "type": "integer",
              "default": 20,
              "enum": [
                10,
                20,
                50,
                100
              ]
            },
            "required": false
          },
          {
            "in": "query",
            "name": "page",
            "description": "Page number",
            "schema": {
              "type": "integer",
              "default": 0,
              "minimum": 0
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Source was successfully obtained",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/GetSourceListResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/source": {
      "get": {
        "summary": "Get information about source",
        "description": "Retrieves information about the source using its id",
        "tags": [
          "source"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "id",
            "description": "HyperLeda source id",
            "schema": {
              "type": "integer"
            },
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Source was successfully obtained",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/GetSourceResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/pipeline/catalogs": {
      "get": {
        "summary": "Obtain list of catalogs",
        "description": "Obtains a list of catalogs according to query.",
        "tags": [
          "table"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "query",
            "description": "Query for catalog searching",
            "schema": {
              "type": "string",
              "example": "dss"
            },
            "required": true
          },
          {
            "in": "query",
            "name": "page_size",
            "description": "Maximum number of catalogs to return",
            "schema": {
              "type": "integer",
              "default": 10,
              "enum": [
                5,
                10,
                20
              ]
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Query successfully returned results.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/SearchCatalogsResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/task": {
      "post": {
        "summary": "Start processing task",
        "description": "Starts background task.",
        "tags": [
          "admin",
          "tasks"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StartTaskRequestSchema"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Task successfully started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/CreateSourceResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Get information about the task",
        "description": "Retrieves information about the task using its id.",
        "tags": [
          "tasks",
          "admin"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "task_id",
            "description": "ID of the task",
            "schema": {
              "type": "integer"
            },
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Task was successfully obtained",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/GetTaskInfoResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/debug/task": {
      "post": {
        "summary": "Start processing task",
        "description": "Starts background task.",
        "tags": [
          "admin",
          "tasks"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StartTaskRequestSchema"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Task successfully started",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/CreateSourceResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/table": {
      "post": {
        "summary": "Create table with unprocessed data",
        "description": "Describes schema of the table without any data.",
        "tags": [
          "admin",
          "table"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateTableRequestSchema"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Table was successfully created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/CreateTableResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/admin/table/data": {
      "post": {
        "summary": "Add new raw data to the table",
        "description": "Inserts new data to the table.",
        "tags": [
          "admin",
          "table"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddDataRequestSchema"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Source was successfully created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "$ref": "#/components/schemas/AddDataResponseSchema"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "info": {
    "title": "HyperLeda API specification",
    "version": "1.0.0"
  },
  "openapi": "3.0.2",
  "components": {
    "schemas": {
      "PingRequestSchema": {
        "type": "object",
        "properties": {}
      },
      "PingResponseSchema": {
        "type": "object",
        "properties": {
          "ping": {
            "type": "string",
            "example": "pong"
          }
        }
      },
      "CreateSourceRequestSchema": {
        "type": "object",
        "properties": {
          "bibcode": {
            "type": "string",
            "description": "Bibcode of publication",
            "example": "2001quant.ph..1003R"
          },
          "title": {
            "type": "string",
            "description": "Title of publication"
          },
          "authors": {
            "type": "array",
            "description": "List of authors",
            "items": {
              "type": "string"
            }
          },
          "year": {
            "type": "integer",
            "minimum": 0,
            "description": "Year of the publication"
          }
        }
      },
      "CreateSourceResponseSchema": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "HyperLeda bibliography id"
          }
        },
        "required": [
          "id"
        ]
      },
      "GetSourceListRequestSchema": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string",
            "description": "Filter for the title"
          },
          "page_size": {
            "type": "integer",
            "default": 20,
            "enum": [
              10,
              20,
              50,
              100
            ],
            "description": "Number of entries in the page"
          },
          "page": {
            "type": "integer",
            "default": 0,
            "minimum": 0,
            "description": "Page number"
          }
        },
        "required": [
          "title"
        ]
      },
      "GetSourceResponse": {
        "type": "object",
        "properties": {
          "bibcode": {
            "type": "string",
            "description": "Bibcode of publication"
          },
          "title": {
            "type": "string",
            "description": "Title of publication"
          },
          "authors": {
            "type": "array",
            "description": "List of authors",
            "items": {
              "type": "string"
            }
          },
          "year": {
            "type": "integer",
            "description": "Year of the publication"
          }
        }
      },
      "GetSourceListResponseSchema": {
        "type": "object",
        "properties": {
          "sources": {
            "type": "array",
            "description": "List of sources",
            "items": {
              "$ref": "#/components/schemas/GetSourceResponse"
            }
          }
        }
      },
      "GetSourceRequestSchema": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "HyperLeda source id"
          }
        },
        "required": [
          "id"
        ]
      },
      "GetSourceResponseSchema": {
        "type": "object",
        "properties": {
          "bibcode": {
            "type": "string",
            "description": "Bibcode of publication"
          },
          "title": {
            "type": "string",
            "description": "Title of publication"
          },
          "authors": {
            "type": "array",
            "description": "List of authors",
            "items": {
              "type": "string"
            }
          },
          "year": {
            "type": "integer",
            "description": "Year of the publication"
          }
        }
      },
      "SearchCatalogsRequestSchema": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "Query for catalog searching",
            "example": "dss"
          },
          "page_size": {
            "type": "integer",
            "default": 10,
            "enum": [
              5,
              10,
              20
            ],
            "description": "Maximum number of catalogs to return"
          }
        },
        "required": [
          "query"
        ]
      },
      "Field": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Field name"
          },
          "description": {
            "type": "string",
            "description": "Field description"
          },
          "unit": {
            "type": "string",
            "description": "Unit of measurements"
          }
        }
      },
      "Table": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Table id"
          },
          "num_rows": {
            "type": "integer",
            "description": "Number of rows in the table"
          },
          "fields": {
            "type": "array",
            "description": "List of fields in the table with their metadata",
            "items": {
              "$ref": "#/components/schemas/Field"
            }
          }
        }
      },
      "Catalog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Vizier ID of the catalog"
          },
          "description": {
            "type": "string",
            "description": "Description of the catalog"
          },
          "url": {
            "type": "string",
            "description": "Link to the catalog"
          },
          "bibcode": {
            "type": "string",
            "description": "Catalog bibliography"
          },
          "tables": {
            "type": "array",
            "description": "List of tables with their metadata",
            "items": {
              "$ref": "#/components/schemas/Table"
            }
          }
        }
      },
      "SearchCatalogsResponseSchema": {
        "type": "object",
        "properties": {
          "catalogs": {
            "type": "array",
            "description": "List of catalogs with tables and various metadata",
            "items": {
              "$ref": "#/components/schemas/Catalog"
            }
          }
        }
      },
      "StartTaskRequestSchema": {
        "type": "object",
        "properties": {
          "task_name": {
            "type": "string",
            "description": "Name of the task to start",
            "example": "echo"
          },
          "payload": {
            "type": "object",
            "description": "Payload to the task",
            "example": {
              "sleep_time_seconds": 2
            }
          }
        },
        "required": [
          "task_name"
        ]
      },
      "StartTaskResponseSchema": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID of the task"
          }
        }
      },
      "GetTaskInfoRequestSchema": {
        "type": "object",
        "properties": {
          "task_id": {
            "type": "integer",
            "description": "ID of the task"
          }
        },
        "required": [
          "task_id"
        ]
      },
      "GetTaskInfoResponseSchema": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID of the task"
          },
          "task_name": {
            "type": "string",
            "description": "Name of the task from task registry"
          },
          "status": {
            "type": "string",
            "description": "Task status"
          },
          "payload": {
            "type": "object",
            "description": "Payload to the task"
          },
          "start_time": {
            "type": "string",
            "format": "date-time",
            "description": "Time when task started"
          },
          "end_time": {
            "type": "string",
            "format": "date-time",
            "description": "Time when task ended"
          },
          "message": {
            "type": "object",
            "description": "Message associated with the task status"
          }
        }
      },
      "ColumnDescription": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the column"
          },
          "data_type": {
            "type": "string",
            "enum": [
              "str",
              "string",
              "int",
              "integer",
              "float",
              "double"
            ],
            "description": "Type of data"
          },
          "unit": {
            "type": "string",
            "description": "Unit of the data"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of the column"
          }
        },
        "required": [
          "data_type",
          "name",
          "unit"
        ]
      },
      "CreateTableRequestSchema": {
        "type": "object",
        "properties": {
          "table_name": {
            "type": "string",
            "description": "Name of the table"
          },
          "columns": {
            "type": "array",
            "description": "List of columns in the table",
            "items": {
              "$ref": "#/components/schemas/ColumnDescription"
            }
          },
          "bibliography_id": {
            "type": "integer",
            "description": "ID of the bibliographic data assosiated with this table"
          },
          "datatype": {
            "type": "string",
            "default": "regular",
            "enum": [
              "regular",
              "reprocessing",
              "preliminary",
              "compilation"
            ],
            "description": "Type of the data in the table"
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of the table"
          }
        },
        "required": [
          "bibliography_id",
          "columns",
          "table_name"
        ]
      },
      "CreateTableResponseSchema": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "Output id of the table"
          }
        }
      },
      "AddDataRequestSchema": {
        "type": "object",
        "properties": {
          "table_id": {
            "type": "integer",
            "description": "ID of the table to add data to"
          },
          "data": {
            "type": "array",
            "description": "\n            Actual data to append. \n            Keys in this dictionary must be a subset of the columns in the table. \n            If not specified, column will be set to NULL.\n        ",
            "items": {
              "type": "object"
            }
          }
        },
        "required": [
          "data",
          "table_id"
        ]
      },
      "AddDataResponseSchema": {
        "type": "object",
        "properties": {}
      }
    }
  }
}